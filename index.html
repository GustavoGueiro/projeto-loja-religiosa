<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Loja Religiosa</title>

  <!-- Fonte -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg:#f6f7fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --primary:#0ea5e9;
      --ring:rgba(14,165,233,.35);
      --success:#16a34a;
      --shadow:0 10px 25px rgba(2,6,23,.06);
      --shadow-hover:0 14px 32px rgba(2,6,23,.12);
      --radius:20px;
    }

    body{
      margin:0;
      height:100vh;
      display:flex;
      background:var(--bg);
      color:var(--text);
      font-family:"Inter",sans-serif;
    }

    /* Sidebar */
    aside{
      width:260px;
      background:var(--card);
      padding:22px 18px;
      box-shadow:var(--shadow);
      display:flex;
      flex-direction:column;
      gap:18px;
    }

    .logo{font-weight:800;font-size:1.15rem}
    .welcome-box{
      background:#f1f5f9;
      border:1px solid #e2e8f0;
      border-radius:12px;
      padding:12px 14px;
      box-shadow:var(--shadow);
    }
    .welcome-box .hello{display:block;color:var(--muted);font-size:.9rem;margin-bottom:4px}
    #welcome-name{color:var(--primary);font-weight:700}

    nav{display:flex;flex-direction:column;gap:8px;margin-top:6px}
    nav button{
      display:flex;align-items:center;gap:10px;
      width:100%;padding:11px 12px;border-radius:12px;
      background:#f8fafc;border:1px solid #e2e8f0;color:#0f172a;
      cursor:pointer;font-weight:600;transition:.18s;
    }
    nav button:hover{background:var(--primary);color:#fff;border-color:transparent}
    .sidebar-footer{margin-top:auto}
    .btn{padding:10px 14px;border:none;border-radius:12px;background:var(--primary);color:#fff;font-weight:700;cursor:pointer;box-shadow:0 6px 14px rgba(14,165,233,.25)}
    .btn:hover{filter:brightness(.96);transform:translateY(-1px)}
    .btn:active{transform:translateY(0)}
    .btn-sair{background:#dc2626;box-shadow:0 6px 14px rgba(220,38,38,.2)}

    main{flex:1;padding:30px 34px;overflow:auto}
    h1{margin:0 0 8px;font-size:1.8rem}
    #boas-vindas{margin:0 0 18px;color:var(--primary);font-weight:600}

    .grid{display:grid;gap:22px;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));margin-top:8px}
    .card{
      background:var(--card);border:1px solid rgba(2,6,23,.06);
      border-radius:var(--radius);padding:12px;
      box-shadow:var(--shadow);transition:transform .18s,box-shadow .18s,border-color .18s;
    }
    .card:hover{transform:translateY(-4px);box-shadow:var(--shadow-hover);border-color:rgba(2,6,23,.1)}
    .thumb{position:relative;width:100%;aspect-ratio:4/3;overflow:hidden;border-radius:16px;background:#f1f5f9;margin-bottom:12px}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .45s ease}
    .card:hover .thumb img{transform:scale(1.04)}
    .card h3{margin:2px 6px 4px;font-size:1.05rem;font-weight:800}
    .card p{margin:0 6px 12px;color:var(--muted);font-size:.92rem;line-height:1.45;min-height:2.6em}
    .meta{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:0 6px 6px}
    .price{font-weight:800}

    #sec-dashboard{display:none;margin-top:26px;background:var(--card);border:1px solid #e2e8f0;border-radius:16px;padding:18px;box-shadow:var(--shadow)}
    #sec-dashboard h2{margin:0 0 12px}
  </style>
</head>
<body>
  <aside>
    <div>
      <div class="logo">‚úù Loja Religiosa</div>

      <div class="welcome-box">
        <span class="hello">üôè Bem-vindo(a),</span>
        <strong id="welcome-name">Visitante</strong>
      </div>

      <nav>
        <button id="btnInicio" type="button">üè† In√≠cio</button>
        <button id="btnCatalogo" type="button">üìñ Cat√°logo</button>
        <button id="btnDashboard" type="button" style="display:none;">üìä Dashboard</button>
      </nav>
    </div>

    <div class="sidebar-footer">
      <small style="color:var(--muted);display:block;margin-bottom:8px">
        Logado como <span id="role-label">Cliente</span>
      </small>
      <button id="btnSair" class="btn btn-sair" type="button">Sair</button>
    </div>
  </aside>

  <main>
    <h1>Cat√°logo de Produtos</h1>
    <p id="boas-vindas"></p>

    <div id="produtos" class="grid"></div>

    <section id="sec-dashboard">
      <h2>Dashboard de Vendas</h2>
      <canvas id="chartVendas" width="900" height="360"></canvas>
    </section>
  </main>

  <script>
  // Detecta o prefixo do reposit√≥rio quando estiver no GitHub Pages (/projeto-loja-religiosa)
  const pathParts = location.pathname.split("/").filter(Boolean);
  const repo = pathParts.length > 0 ? `/${pathParts[0]}` : "";

  // üîó Base da API: localhost em dev, Render em produ√ß√£o (sempre HTTPS)
  const API_BASE =
    location.hostname === "localhost" || location.hostname === "127.0.0.1"
      ? "http://localhost:8080"
      : "https://api-loja-religiosa.onrender.com";

  // ‚ûú URL final dos produtos (N√ÉO deixe vazio)
  const API_URL = `${API_BASE}/produtos`;

  // Render do cat√°logo
  async function carregarProdutos() {
    try {
      console.log("[cat√°logo] API_URL =", API_URL); // <-- deve logar ...onrender.com/produtos
      const res = await fetch(API_URL, { mode: "cors", cache: "no-store" });
      console.log("[cat√°logo] status =", res.status);
      if (!res.ok) throw new Error(`HTTP ${res.status}`);

      const produtos = await res.json();
      const el = document.getElementById("produtos");

      el.innerHTML = produtos.map(p => {
        const imgSrc = p.imagem && p.imagem.startsWith("http")
          ? p.imagem
          : `${repo}/${String(p.imagem || "").replace(/^\/?/, "")}`;

        return `
          <div class="card">
            <div class="thumb">
              <img
                src="${imgSrc}"
                alt="${p.nome}"
                referrerpolicy="no-referrer"
                onerror="this.onerror=null; this.src='https://picsum.photos/seed/erro/600/450';"
              />
            </div>
            <h3>${p.nome}</h3>
            <p>${p.descricao}</p>
            <div class="meta">
              <span class="price">R$ ${Number(p.preco).toFixed(2)}</span>
              <button class="btn" type="button">Comprar</button>
            </div>
          </div>
        `;
      }).join("");
    } catch (e) {
      console.error("[cat√°logo] falha ao buscar API:", e);
      document.getElementById("produtos").innerHTML =
        `<p style="color:#dc2626">Erro ao carregar produtos.</p>`;
    }
  }

  // Alterna se√ß√µes
  function mostrarCatalogo() {
    document.getElementById("produtos").style.display = "";
    document.getElementById("sec-dashboard")?.style && (document.getElementById("sec-dashboard").style.display = "none");
  }
  function mostrarDashboard() {
    document.getElementById("produtos").style.display = "none";
    document.getElementById("sec-dashboard").style.display = "";
    desenharGraficoVendas();
  }

  // Gr√°fico (opcional)
  function desenharGraficoVendas() {
    const ctx = document.getElementById("chartVendas");
    if (!ctx) return;
    if (window.__graficoVendas) window.__graficoVendas.destroy();
    window.__graficoVendas = new Chart(ctx, {
      type: "bar",
      data: {
        labels: ["Jan","Fev","Mar","Abr","Mai","Jun"],
        datasets: [{ label: "Vendas (R$)", data: [1200,1750,1600,2100,1950,2500] }]
      },
      options: { responsive: true, scales: { y: { beginAtZero: true } } }
    });
  }

  // Boot
  document.addEventListener("DOMContentLoaded", () => {
    const usuario = localStorage.getItem("usuario");
    const role = localStorage.getItem("role") || "cliente";
    if (!usuario) {
      alert("Voc√™ precisa fazer login primeiro.");
      location.href = `${repo}/login.html`;
      return;
    }

    // UI
    const w = document.getElementById("welcome-name");
    if (w) w.textContent = usuario;
    const r = document.getElementById("role-label");
    if (r) r.textContent = role === "admin" ? "Administrador" : "Cliente";

    // Sair
    const btnSair = document.getElementById("btnSair");
    if (btnSair) btnSair.onclick = () => { localStorage.clear(); location.href = `${repo}/login.html`; };

    // Navega√ß√£o
    document.getElementById("btnInicio")?.addEventListener("click", mostrarCatalogo);
    document.getElementById("btnCatalogo")?.addEventListener("click", mostrarCatalogo);
    const btnDash = document.getElementById("btnDashboard");
    if (btnDash) {
      if (role === "admin") { btnDash.style.display = ""; btnDash.onclick = mostrarDashboard; }
      else { btnDash.style.display = "none"; }
    }

    // Exibe cat√°logo e busca dados
    mostrarCatalogo();
    carregarProdutos();
  });
</script>


</body>
</html>
